<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram QR Scanner</title>
    <script>
        window.addEventListener('load', function() {
            // Проверяем, запущен ли WebApp внутри Telegram
            if (window.Telegram && window.Telegram.WebApp) {
                console.log("Telegram WebApp API инициализировано.");
                window.Telegram.WebApp.ready();  // Инициализируем WebApp API

                // Активируем кнопку после инициализации
                const scanButton = document.getElementById('scan-button');
                scanButton.disabled = false;  // Делаем кнопку активной
            } else {
                // Сообщаем об ошибке, если API не найден
                alert('Telegram WebApp API недоступен. Убедитесь, что WebApp запущен внутри Telegram.');
                console.log('Ошибка: Telegram WebApp API не найдено');
            }
        });

        // Функция для сканирования QR-кода
        function scanQRCode() {
            // Проверяем, поддерживается ли функция сканирования
            if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.showScanQrPopup) {
                console.log('Открытие окна сканирования QR-кода...');
                window.Telegram.WebApp.showScanQrPopup({
                    text: 'Сканировать QR-код',
                    onSuccess: function(data) {
                        console.log('QR-код успешно отсканирован:', data);
                        // Отправляем данные обратно в бота
                        window.Telegram.WebApp.sendData(data);  // Отправляем данные обратно в Telegram бот
                    },
                    onError: function() {
                        console.log('Ошибка при сканировании QR-кода.');
                        alert('Ошибка при сканировании QR-кода. Попробуйте снова.');
                    }
                });
            } else {
                // Сообщаем об отсутствии поддержки сканирования
                alert('Сканирование QR-кодов недоступно. Проверьте, что WebApp запущен внутри Telegram.');
                console.log('Ошибка: Функция showScanQrPopup недоступна.');
            }
        }
    </script>
</head>
<body>
    <h1>Сканирование QR-кода</h1>
    <button id="scan-button" onclick="scanQRCode()" disabled>Сканировать QR-код</button>
</body>
</html>

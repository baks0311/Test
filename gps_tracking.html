<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Отслеживание геопозиции</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <h1>Отслеживание вашего местоположения включено</h1>
    <div id="status">Ожидание координат...</div>

    <script>
        // Function to send data to bot
        function sendLocationToBot(latitude, longitude) {
            const locationData = {
                app_type: 'gps', // Specify app_type as 'gps' for correct processing on the bot side
                latitude: latitude,
                longitude: longitude
            };
            // Send data in JSON format to the bot
            Telegram.WebApp.sendData(JSON.stringify(locationData));
            console.log("Данные отправлены в бота:", locationData);
        }

        // Function to track location
        function startTrackingLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(
                    function (position) {
                        const latitude = position.coords.latitude;
                        const longitude = position.coords.longitude;

                        // Update status display with coordinates
                        document.getElementById("status").innerText = `Координаты: ${latitude}, ${longitude}`;

                        // Send coordinates to the bot
                        sendLocationToBot(latitude, longitude);
                    },
                    function (error) {
                        console.error("Ошибка при получении геопозиции:", error);
                        document.getElementById("status").innerText = "Ошибка при получении геопозиции";
                    },
                    {
                        enableHighAccuracy: true, // High accuracy
                        maximumAge: 0,            // Do not cache coordinates
                        timeout: 5000             // Timeout for coordinate retrieval
                    }
                );
            } else {
                document.getElementById("status").innerText = "Геолокация не поддерживается вашим устройством.";
            }
        }

        // Check WebApp readiness and start location tracking upon page load
        window.addEventListener('load', function() {
            if (window.Telegram && window.Telegram.WebApp) {
                console.log("Telegram WebApp API инициализировано.");
                Telegram.WebApp.ready(); // Notify that WebApp is ready

                // Start tracking
                startTrackingLocation();
            } else {
                alert('Telegram WebApp API недоступен. Убедитесь, что приложение запущено внутри Telegram.');
                console.log('Ошибка: Telegram WebApp API не найдено.');
            }
        });
    </script>
</body>
</html>

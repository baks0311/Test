<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Отслеживание геопозиции</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <h1>Отслеживание вашего местоположения включено</h1>
    <div id="status">Ожидание координат...</div>

    <script>
        // Функция для отправки данных в бота
        function sendLocationToBot(latitude, longitude) {
            const locationData = { 
                latitude: latitude, 
                longitude: longitude,
                app_type: 'gps' // Указываем тип приложения для уникальной идентификации
            };
            Telegram.WebApp.sendData(JSON.stringify(locationData));
        }

        // Функция отслеживания координат
        function startTrackingLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(
                    function (position) {
                        const latitude = position.coords.latitude;
                        const longitude = position.coords.longitude;

                        document.getElementById("status").innerText = `Координаты: ${latitude}, ${longitude}`;

                        // Отправляем координаты в бот
                        sendLocationToBot(latitude, longitude);
                    },
                    function (error) {
                        console.error("Ошибка при получении геопозиции:", error);
                        document.getElementById("status").innerText = "Ошибка при получении геопозиции.";
                    },
                    { enableHighAccuracy: true, maximumAge: 0, timeout: 5000 }
                );
            } else {
                document.getElementById("status").innerText = "Геолокация не поддерживается";
            }
        }

        // Старт отслеживания при загрузке
        Telegram.WebApp.ready();
        startTrackingLocation();
    </script>
</body>
</html>
